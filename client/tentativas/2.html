<!DOCTYPE html>
<html lang="pt">
<head>
    <link rel="stylesheet" href="./css/style.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas</title>
</head>
<body>
    <div class="content">
        <div class="statusbar enemy">
            <div class="energybar enemy-energy">
                <div class="energy enemys"></div>
            </div>
            <div class="health your-health">
                <div class="healthpoint green"></div>
                <div class="healthpoint green"></div>
                <div class="healthpoint green"></div>
                <div class="healthpoint green"></div>
                <div class="healthpoint red"></div>
            </div>
        </div>
        <div class="game">
            <canvas width="600" height="600">
                
            </canvas>
        </div>
        <div class="statusbar your">
            <div class="energybar your-energy">
                <div class="energy yours"></div>
            </div>
            <div class="health your-health">
                <div class="healthpoint green"></div>
                <div class="healthpoint green"></div>
                <div class="healthpoint green"></div>
                <div class="healthpoint red"></div>
                <div class="healthpoint red"></div>
            </div>
        </div>
    </div>
</body>
    <script>

        function teste() {
            console.log('interval')
        }

        setInterval(teste, 3000)
        
        const canvas = document.querySelector('canvas')
        var context = canvas.getContext('2d')

        function myRandom(min, max, multiple) {
            return Math.round(Math.random() * (max - min) / multiple) * multiple + min;
        }

        const player = {
            x: myRandom(0, 540, 30),
            y: myRandom(300, 540, 30),
            size: 60,
            color: '#5EA7EA'
        }

        const state = {
            bullets: [
                
            ]
        }

        const acceptedKeys = {
            'a': () => {
                player.x > 0 ? player.x = player.x - 30 : false
            },
            'd': () => {
                player.x + 60 < canvas.width ? player.x = player.x + 30 : false
            },
            'w': () => {
                player.y > canvas.height / 2 ? player.y = player.y - 30 : false
            },
            's': () => {
                player.y + 60 < canvas.height ? player.y = player.y + 30 : false
            },
            ' ': () => {
                state.bullets.push({
                    id: Math.floor(Math.random() * 10000000),
                    from: 'you', 
                    x: player.x + 20, 
                    y: player.y,
                    color: '#138CFC',
                })
                console.log(state.bullets)
            }
        } 

        window.addEventListener('keydown', (e) => {
            const keyPressed = e.key.toLowerCase()
            if(acceptedKeys[keyPressed]) {
                acceptedKeys[keyPressed]()
            }
        }, false)

        function moveBullet() {
                state.bullets.forEach((bullet, index) => {
                    if(bullet.y < 0) {
                        state.bullets.splice(index, 1)
                    }
                    bullet.y = bullet.y - 20
                });
        }

        function render() {
            context.clearRect(0, 0, canvas.height, canvas.width)
            context.fillStyle = '#AFAFAF'
            context.fillRect(0, canvas.height / 2 -1, 600, 2)

            context.fillStyle = player.color
            context.fillRect(player.x, player.y, player.size, player.size)

            state.bullets.forEach(bullet => {
                context.beginPath()
                context.fillStyle = bullet.color
                context.fillRect(bullet.x, bullet.y, 20, 20)
                context.moveTo(100, 100)
            });
        }

        renderScreen()

        function renderScreen() {
            requestAnimationFrame(renderScreen, canvas)
            render()
        }

    </script>
</html>